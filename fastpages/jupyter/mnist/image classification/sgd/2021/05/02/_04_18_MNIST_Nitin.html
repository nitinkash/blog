<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Building an MNIST Classifier using PyTorch and fastai | Nitin Kashyap</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Building an MNIST Classifier using PyTorch and fastai" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Building a handwritten digit classifier using PyTorch and fastai" />
<meta property="og:description" content="Building a handwritten digit classifier using PyTorch and fastai" />
<link rel="canonical" href="https://nitinkash.github.io/blog/fastpages/jupyter/mnist/image%20classification/sgd/2021/05/02/_04_18_MNIST_Nitin.html" />
<meta property="og:url" content="https://nitinkash.github.io/blog/fastpages/jupyter/mnist/image%20classification/sgd/2021/05/02/_04_18_MNIST_Nitin.html" />
<meta property="og:site_name" content="Nitin Kashyap" />
<meta property="og:image" content="https://nitinkash.github.io/blog/images/some_folder/your_image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-05-02T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Building a handwritten digit classifier using PyTorch and fastai","url":"https://nitinkash.github.io/blog/fastpages/jupyter/mnist/image%20classification/sgd/2021/05/02/_04_18_MNIST_Nitin.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://nitinkash.github.io/blog/fastpages/jupyter/mnist/image%20classification/sgd/2021/05/02/_04_18_MNIST_Nitin.html"},"headline":"Building an MNIST Classifier using PyTorch and fastai","dateModified":"2021-05-02T00:00:00-05:00","datePublished":"2021-05-02T00:00:00-05:00","image":"https://nitinkash.github.io/blog/images/some_folder/your_image.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nitinkash.github.io/blog/feed.xml" title="Nitin Kashyap" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Nitin Kashyap</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/index%20-%20Copy.html">Home</a><a class="page-link" href="/blog/">Home</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Building an MNIST Classifier using PyTorch and fastai</h1><p class="page-description">Building a handwritten digit classifier using PyTorch and fastai</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-05-02T00:00:00-05:00" itemprop="datePublished">
        May 2, 2021
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      13 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#fastpages">fastpages</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#jupyter">jupyter</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#MNIST">MNIST</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#Image Classification">Image Classification</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#SGD">SGD</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/nitinkash/fastai-deeplearning/tree/master/_notebooks/2021_04_18_MNIST_Nitin.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/nitinkash/fastai-deeplearning/master?filepath=_notebooks%2F2021_04_18_MNIST_Nitin.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/nitinkash/fastai-deeplearning/blob/master/_notebooks/2021_04_18_MNIST_Nitin.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021_04_18_MNIST_Nitin.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here I am building a Deep Learning Classifier to classify handwritten digits based on the MNIST dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><div class="flash flash-error">
    <svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path></svg>
    <strong>Warning: </strong>You might need to explcitly specify using fastai V2 on Google Chrome. See <a href="https://forums.fast.ai/t/modulenotfounderror-no-module-named-fastai-vision-all-on-kaggle-notebook/77008/13?u=nitinkashyap">https://forums.fast.ai/t/modulenotfounderror-no-module-named-fastai-vision-all-on-kaggle-notebook/77008/13?u=nitinkashyap</a>
</div>
After Google Chrome crashed again, I moved to Brave Browser and didn't have this issue again</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Quite pissed that I ran into some issues in the import statement itself. After some googling in the fastai forums, I found that apparently the fastai version (v2) needs to be explicitly defined. Somehow the notebooks used in the course circumvents this. Anyway glad to have found the answer within a few minutes of googling. If you have this error just follow this: <a href="https://forums.fast.ai/t/modulenotfounderror-no-module-named-fastai-vision-all-on-kaggle-notebook/77008/13?u=nitinkashyap">https://forums.fast.ai/t/modulenotfounderror-no-module-named-fastai-vision-all-on-kaggle-notebook/77008/13?u=nitinkashyap</a></p>
<p>EDIT: Wrote the above part and then Colab on Google chrome crashed for the umpteenth time. I moved to Brave Browser and the original code works perfectly. Guess there was some issue with Google Chrome.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I absolutely love how fastai has managed to improve the readability of python and provide such small elegant functions that used to be a pain for me to create on python jupyter notebooks before. Usually had about three or four lines of code that just set the input and output paths before. Using the untar_data to basically download the data from fastai's AWS S3 on to the working directory and decompress this. this function returns the path of the extracted files. SO SO Elegant!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Another nifty little thing fastai has provided is to access the working directory directly on jupyter books using path.ls()</p>

<pre><code>path.ls()</code></pre>
<p>I remember toggling back and forth between the terminal and the jupyter notebook while working before. It's the little things like this that let you focus on the deep learning part of the process.</p>
<p>Big thanks to the fastai team for including so many such features.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The MNIST dataset follows a common layout for machine learning datasets: separate folders for the training set and the validation set (and/or test set). Let's see what's inside the training set:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;testing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#10) [Path(&#39;testing/5&#39;),Path(&#39;testing/1&#39;),Path(&#39;testing/7&#39;),Path(&#39;testing/3&#39;),Path(&#39;testing/0&#39;),Path(&#39;testing/6&#39;),Path(&#39;testing/8&#39;),Path(&#39;testing/4&#39;),Path(&#39;testing/9&#39;),Path(&#39;testing/2&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;training&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#10) [Path(&#39;training/5&#39;),Path(&#39;training/1&#39;),Path(&#39;training/7&#39;),Path(&#39;training/3&#39;),Path(&#39;training/0&#39;),Path(&#39;training/6&#39;),Path(&#39;training/8&#39;),Path(&#39;training/4&#39;),Path(&#39;training/9&#39;),Path(&#39;training/2&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are separate folders for inages of each of the 10 digits. Usually, without having any pre-defined functions to read in the data, we would have to read in the files using something like</p>

<pre><code>ones = (path/'training'/'1').ls().sorted()
twos = (path/'training'/'2').ls().sorted()
threes = (path/'training'/'3').ls().sorted()
fours = (path/'training'/'4').ls().sorted()
fives = (path/'training'/'5').ls().sorted()
sixes = (path/'training'/'6').ls().sorted()
sevens = (path/'training'/'7').ls().sorted()
eights = (path/'training'/'8').ls().sorted()
nines = (path/'training'/'9').ls().sorted()
zeros = (path/'training'/'0').ls().sorted()</code></pre>
<p>This is cumbersome and might lead to some inadverent errors while writing the lines of code for each separate category of image. This would be even more painful if the number of categories increases. 
<div class="flash flash-success">
    <svg class="octicon octicon-checklist" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M2.5 1.75a.25.25 0 01.25-.25h8.5a.25.25 0 01.25.25v7.736a.75.75 0 101.5 0V1.75A1.75 1.75 0 0011.25 0h-8.5A1.75 1.75 0 001 1.75v11.5c0 .966.784 1.75 1.75 1.75h3.17a.75.75 0 000-1.5H2.75a.25.25 0 01-.25-.25V1.75zM4.75 4a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-4.5zM4 7.75A.75.75 0 014.75 7h2a.75.75 0 010 1.5h-2A.75.75 0 014 7.75zm11.774 3.537a.75.75 0 00-1.048-1.074L10.7 14.145 9.281 12.72a.75.75 0 00-1.062 1.058l1.943 1.95a.75.75 0 001.055.008l4.557-4.45z"></path></svg>
    <strong>Tip: </strong>Use the inbuilt DataLoaders(ImageDataLoaders, TextDataLoaders, etc.) classes to easily import data.
</div>
Fortunately, fastai also has an inbuilt ImageDataLoaders class that helps us easily import the required files and also automatically assign the labels.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here I am deciding to import the files in the training set only. I will be creating a validaton dataset using 25% of the data and then testing the model on the testing dataset once I a happy with the model's performance.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">ImageDataLoaders</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="n">valid_pct</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's take a look at these images to make sure the ImageDataLoaders method is doing what we expect it to do.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">train_ds</span><span class="o">.</span><span class="n">items</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Path(&#39;training/0/662.png&#39;),
 Path(&#39;training/1/22555.png&#39;),
 Path(&#39;training/2/38070.png&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIHCAYAAADpfeRCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjIsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+WH4yJAAAgAElEQVR4nO3debRU1ZXH8X2YIWiYRxVol2iMIqBZxtYOIkIaBAwoSCIgohIxIUZAESMiQxBFcMbggEGcAsqgaFA0iBrRmCgaNYAMgihTEAwgM6f/eITY7FN4a3h169b+ftZydfpH3aqtHOD3Lued67z3AgAAbCkT9wAAACD/KAAAABhEAQAAwCAKAAAABlEAAAAwiAIAAIBBFAAAAAyiAGTAOdfYOfeCc26zc26dc+5e51y5uOcConLOfc859yfn3FfOuWXOuS5xzwSkwzm37ZB/9jnn7ol7riShAGRmoohsEJH6ItJcRFqJyFWxTgREdKCszhaROSJSQ0T6ichjzrmmsQ4GpMF7X/Xf/4hIPRHZISLTYx4rUSgAmWkiItO89zu99+tEZK6IfD/mmYCoThCRBiJyh/d+n/f+TyLyZxHpFe9YQMYukJIvyl6Pe5AkoQBk5k4R6eGcq+Kcaygi7aWkBABJ5UTkpLiHADJ0iYg86jnbPi0UgMy8JiVf8f9LRNaIyF9FZFasEwHRLZGSr5audc6Vd861k5K/xqoS71hA+pxzjaRk/U6Je5akoQCkyTlXRkq+2p8hIt8RkVoiUl1Ebo1zLiAq7/0eEfmJiJwnIutEZJCITJOSMgskTS8RecN7vzLuQZKGApC+GiJyjIjc673f5b3fJCKPiEiHeMcCovPef+C9b+W9r+m9/7GI/JeI/CXuuYAM9Ba++s8IBSBN3vt/ishKEenvnCvnnKsmJX//9EG8kwHROeeaOecqHdjHMlhKvqPl9zGPBaTFOfffItJQ2P2fEQpAZrqKyP+KyEYRWSYie0TkmlgnAtLTS0TWSslegDYi0tZ7vyvekYC0XSIiM7z3W+MeJIkcmyYBALCHOwAAABhEAQAAwCAKAAAABlEAAAAwiAIAAIBBh32ErXOObxFAxrz3Lu4ZWMPIRiGsYRHWMbKTah1zBwAAAIMoAAAAGEQBAADAIAoAAAAGUQAAADCIAgAAgEEUAAAADKIAAABgEAUAAACDKAAAABhEAQAAwCAKAAAABlEAAAAwiAIAAIBBFAAAAAyiAAAAYBAFAAAAgygAAAAYRAEAAMAgCgAAAAZRAAAAMIgCAACAQRQAAAAMogAAAGBQubgHSIrKlSurrEOHDiq7+OKLVda2bVuVrVixIvg5l1xyicref/99lXnvg9cDABAFdwAAADCIAgAAgEEUAAAADKIAAABgkDvcZjLnnMmdZp07d1bZQw89pLJatWrlYxypUKGCyvbu3ZuXz86G997FPYPVNTx//nyVnX322Rm/36uvvqqyESNGRH5tUhXCGhaxu46RG6nWMXcAAAAwiAIAAIBBFAAAAAyiAAAAYJD5TYBDhw5V2ejRo1XmXLS9QJ999pnK5syZo7IaNWoErz/hhBNUduqpp6ps//79keaJUyFsoLKwhgvtVMjWrVurLKkbAwthDYvkbx2HNoqGsptvvjmn7yciMnz48EjvWWhCazv0ayBObAIEAAAHUQAAADCIAgAAgEEUAAAADDKzCfCUU04J5nPnzlVZ3bp1I73nxIkTVXbttdeqbMeOHSqrWrVq8D3Lly+vss2bN0eap9AUwgaqYlrDqTZPhU79y7XQRqdsThYUib6xNk6FsIZFSmcdh37+8rGWLCi0tc0mQAAAcBAFAAAAgygAAAAYRAEAAMCgcnEPkC8DBw4M5lE3/IVOqRo3bpzKdu7cGen9tm3bFul1sCnXj/MVyf2JZak2jEWdM3R9oZ2gVsyyXU+5lurx0lFEPZkwnWtbtWqlsqj/zULvmc2MpYU7AAAAGEQBAADAIAoAAAAGUQAAADDIzEmAK1euDOaNGzdW2aRJk1T2q1/9SmW7d+/Oeq4ojj76aJWNGjVKZccff7zKQnO/8847uRnsWxTCKWpJWMOl8TjffDyStzTmTsoJavmWr3VcGpvpkiqb9Z2UdcwdAAAADKIAAABgEAUAAACDKAAAABhEAQAAwKCiPAo4dGxvo0aNgq9du3atyn7961+rLNc7/suUCXev0OxDhw5VWbly0X7qzjvvPJXl67sAkB/52HHMc+JtKLad/FEU2pHI+cQdAAAADKIAAABgEAUAAACDKAAAABhUlJsAU22wC9m4caPKjjvuOJWtWbMm43mqV6+usgcffDD42myeh75582aVTZ48OeP3Q+5F3WQVOrY3m+elpxKaJ5vnoKeSr38fIF2hjdfpSPI65g4AAAAGUQAAADCIAgAAgEEUAAAADHKHe+ZxEp6lHtKnTx+VFdtmuKlTp6ps1KhRKlu2bFk+xgkqhGepF9oajvqM8dI43S90ml++TkELbW4NbQwsNIWwhkUKbx0Xk6i/JlPJx0mc2Uq1jrkDAACAQRQAAAAMogAAAGAQBQAAAIOK8iTAadOmqax3797B14Y2J2WzKSS0ISSd99u2bZvKevXqpbLZs2enNxgSJdvHspbGaX5RhTb3JWHDH4pftr+uim0dcwcAAACDKAAAABhEAQAAwCAKAAAABhXlSYAhdevWDebnnHOOyoYMGaKyZs2a5XymkO7du6vs6aefzstn51ohnKJWaGs4ztP48iWpp/6FFMIaFim8dZxU2f76S+ra5iRAAABwEAUAAACDKAAAABhEAQAAwKCiPAkwZP369cH8pZdeUtmwYcMy/pxVq1aprHbt2iqrUqVK8Pojjjgi489G4cv1yZPpiLpZqdg2JcKm0Kl/6axtCydacgcAAACDKAAAABhEAQAAwCAKAAAABpnZBJjKyJEjVXbCCSdEuva2225T2V133aWycePGqexnP/tZ8D3r168f6bNRPEKPkM6XbDYgptoQVWwbpWDTggUL4h6h1HEHAAAAgygAAAAYRAEAAMAgCgAAAAZRAAAAMMjMdwGUKRPuOt27d490/eTJk1U2dOhQlYV2Ve/fvz/SZ4iINGzYMPJrgXTk+ojf0LHGQKFo1apVVteHjhIuNtwBAADAIAoAAAAGUQAAADCIAgAAgEFmNgH27NkzmNesWVNly5cvV9kNN9ygstCGv+rVq6usbdu2UUYUEZG777478muBdMyfPz/jazneF4UstME16qbXESNG5HaYBOEOAAAABlEAAAAwiAIAAIBBFAAAAAwyswmwefPmkV971113qWzDhg0qK1dO/+cLnR5Vt27dyJ+9fv36yK8FUslmw19oU5SFU9GQXNmsd8trmzsAAAAYRAEAAMAgCgAAAAZRAAAAMMjMJsB0HHvssSpr2bKlygYPHqyyHj16RPqMxx57LJhv3bo10vXAv2VzClqI5U1RKG6caPn/cQcAAACDKAAAABhEAQAAwCAKAAAABrnQI20P/qBzqX8wYdq3bx/Mn3/++VL/7O3bt6usWbNmwdeuXLmytMfJG++9i3uGYlrDqYROQcvmUahsAvyPQljDIjbWcVSh9Tl8+PBI17Zu3VplFjYGplrH3AEAAMAgCgAAAAZRAAAAMIgCAACAQWZOAnz//feDeWjTXZMmTTL+nL/85S8qu+KKKyJ9LnA4qTb2ZXPqn4UNUEiu0NqOuuEvtMGV9f7/cQcAAACDKAAAABhEAQAAwCAKAAAABpnZBPjFF18E8549e6rsySefjHT9vHnzVDZy5EiV7du3L8qIwGGVxgYmNkWhkGWzwRXfjjsAAAAYRAEAAMAgCgAAAAZRAAAAMIgCAACAQc771I+Z5hnUyEYhPEvdwho+3K/hbwrt+A89Hx3/UQhrWMTGOg6JurZDnCuIn7qCkGodcwcAAACDKAAAABhEAQAAwCAKAAAABpk5ChgoVmx2QjGYP39+xtdypHVmuAMAAIBBFAAAAAyiAAAAYBAFAAAAgzgJEKWmEE5RYw0jG4WwhkVYx8gOJwECAICDKAAAABhEAQAAwCAKAAAABh12EyAAAChO3AEAAMAgCgAAAAZRAAAAMIgCAACAQRQAAAAMogAAAGAQBQAAAIMoAAAAGEQBAADAIAoAAAAGUQAAADCIAgAAgEEUAAAADKIAAABgEAUgA865xs65F5xzm51z65xz9zrnysU9FxCVc+57zrk/Oee+cs4tc851iXsmIBPOuR7OuX8457Y755Y75/4n7pmSggKQmYkiskFE6otIcxFpJSJXxToRENGBsjpbROaISA0R6ScijznnmsY6GJAm51xbEblVRC4VkSNE5EcisiLWoRKEApCZJiIyzXu/03u/TkTmisj3Y54JiOoEEWkgInd47/d57/8kIn8WkV7xjgWkbYSIjPTev+W93++9/9x7/3ncQyUFBSAzd4pID+dcFedcQxFpLyUlAEgqJyInxT0EEJVzrqyInCYitQ/8NdaaA38dWznu2ZKCApCZ16TkK/5/icgaEfmriMyKdSIguiVS8ldY1zrnyjvn2knJX2NViXcsIC11RaS8iFwoIv8jJX8d20JEboxzqCShAKTJOVdGSr7anyEi3xGRWiJSXUr+HgooeN77PSLyExE5T0TWicggEZkmJWUWSIodB/7vPd77td77f4rIBBHpEONMiUIBSF8NETlGRO713u/y3m8SkUeERYcE8d5/4L1v5b2v6b3/sYj8l4j8Je65gKi895ulpLT6b8YxjZNIFIA0HWiZK0Wkv3OunHOumohcIiIfxDsZEJ1zrplzrtKBfSyDpeQ7Wn4f81hAuh4RkQHOuTrOueoico2UfHcLIqAAZKariPyviGwUkWUiskdKFh6QFL1EZK2U7AVoIyJtvfe74h0JSNsoEXlHRJaKyD9E5D0R+W2sEyWI8547JgAAWMMdAAAADKIAAABgEAUAAACDKAAAABh02CfYOefYIYiMee9d3DOwhpGNQljDIqxjZCfVOuYOAAAABlEAAAAwiAIAAIBBFAAAAAyiAAAAYBAFAAAAgygAAAAYRAEAAMAgCgAAAAZRAAAAMIgCAACAQRQAAAAMogAAAGAQBQAAAIMO+zhgAACKWZky4a+Dp0yZorKePXuq7O6771bZ1Vdfnf1gecAdAAAADKIAAABgEAUAAACDKAAAABhEAQAAwCC+CyALxx13nMo6deqkssGDB6usfv36wfd86623VDZs2DCVvfzyy1FGBAAcRu/evYP5xRdfrLJly5apbMKECTmfKV+4AwAAgEEUAAAADKIAAABgEAUAAACDnPc+9Q86l/oHjenSpYvK7r//fpVt375dZbfddpvKGjZsGPyczp07q+z73/++ymbNmqWybt26Bd8zLt57F/cMrGFkoxDWsAjrOFfOP/98lU2cODH42tARwaE/B0IbtwtNqnXMHQAAAAyiAAAAYBAFAAAAgygAAAAYxCbAgCFDhqhs4MCBKnvxxRdVNnLkSJWFTo9KpVGjRiq76667VHbyySdHyr7++uvIn51rhbCBysIabtCggcrGjh2rsgsvvFBl7733nsrOPPPM3AxWBAphDYvYWMe51rx5c5UtXLhQZan+DOzbt6/KnnrqqewHiwGbAAEAwEEUAAAADKIAAABgEAUAAACDzD8OuH///iobPXq0yoYPH66yMWPG5HyeVatWRfqcOXPmqOy73/2uyuLcBIjcOuaYY4L53LlzVbZ48WKVtWzZUmXt27dXWWhT4RdffBFlRBERGTRokMreeOMNlb399tuR3xM4nEqVKqns7rvvVtn+/ftVdtVVVwXfM6kb/tLBHQAAAAyiAAAAYBAFAAAAgygAAAAYZP4kwLVr16ps3759KmvWrJnKvvzyy1KZ6VC9e/dWWei0wtBjg+NUCKeoJXUNly9fXmUPP/xw8LUXXHCByo466iiVbd68OfvBvuGUU04J5m+++abKLr30UpVNmzYtp/OUhkJYwyLJXceloXHjxip7/PHHVXb66aerrFOnTir74x//mJO5ChknAQIAgIMoAAAAGEQBAADAIAoAAAAGmTkJsFWrVsG8Tp06KgudBNi1a1eVlS1bVmWPPPKIynbv3h1lxJTvOXjwYJWtWLEi8nsieSZMmKCynj17Bl/bp08fleV6w19IaK2n8vHHH5fiJChW9evXV9ktt9yisjPOOENlt99+u8osbPhLB3cAAAAwiAIAAIBBFAAAAAyiAAAAYJCZTYChzX4iIs7pA5KeeeYZlYVOBwydxnf++eerrG/fvipbt25dcJ4bb7xRZSeddJLKBgwYELweyTNixAiV/fKXv1RZly5dgtfPmjUr5zMdKrTRsHnz5sHX3nfffSr78MMPcz0SikzFihVVNmnSJJV17NhRZXfeeafKrr/++twMVsS4AwAAgEEUAAAADKIAAABgEAUAAACDKAAAABjkvE/9mOliegZ1t27dgvkf/vAHlYV2YE+cOFFlRxxxhMruvfdelV100UUqGzt2bHCeYcOGqezZZ59VWeho4sP9XMahEJ6lnoQ1/PXXX6ts+vTpKrvsssuC1+/duzfnMx0qNGOq9daiRQuVLV26NOcz5UMhrGGRZKzjbP3oRz9S2auvvhrp2qZNm6ps2bJl2Y5UNFKtY+4AAABgEAUAAACDKAAAABhEAQAAwCAzRwHPnj07mL/11lsq6969u8r27NmjsnfffVdloSN6TzvtNJXddNNNwXmWLFmistAxrIW24Q+Zq1Spkso++OADleVjs59I+Ijr0Iyp1nBSN/whXmeddVak14U2RdeuXTvStVu2bFHZP//5z0jXFiPuAAAAYBAFAAAAgygAAAAYRAEAAMAgMycBpjJw4ECV3X777ZGuDW3K+vzzz1VWoUIFle3evTv4nqGfj9AJWWvWrIkyYqwK4RS1JKzh0M/54MGDVTZ+/Picf3b16tVVFtrEV7NmTZXVr18/+J7r16/PfrACUQhrWCQZ6ziqE044IZi/9957KqtYsWJOPzu0CXDatGnB1955550qW7x4cU7nyRdOAgQAAAdRAAAAMIgCAACAQRQAAAAMKsqTAMuU0b1m6NChwdeOHDlSZZs2bVLZ1q1bI312aGNU6JHD9913X/D6N998U2UvvPCCyjp06KCyJGwMhDZ16lSV/fSnP1XZG2+8Ebz+s88+U1loHYYeX33GGWeoLLThb8SIESorps1+yJ/rrrsumEfd8DdnzhyVzZs3L9K1O3bsUNm1114bfG3btm1VdsEFF6hs0aJFkT67EHEHAAAAgygAAAAYRAEAAMAgCgAAAAYlfhNgaMPfxIkTVdavX7/g9S+//LLKLr/8cpWtXr060jypNmodasWKFcF80KBBKgudSHXppZeqbNSoUZE+G4VlzJgxKnvkkUdUFtr8JCJSrpz+ZVy5cmWVhR5p/emnn0aYUGT69OmRXgd800knnaSyCy+8MPja0GN5Qxv0nnjiCZWF1nZUqR4HPGPGDJWde+65KmMTIAAASBQKAAAABlEAAAAwiAIAAIBBidoE2KZNG5V169ZNZaFNfL///e+D73njjTeq7Isvvkh/uANefPFFlb399tsqC502KCLy8ccfZ/zZSKbQI0ZDJ/Q1bdo0eP2JJ56ostAm0507d6rsX//6l8pC6591iUxMmjRJZVWrVg2+dty4cSqbMmVKzmc6VNRTBEVEmjdvXoqT5B93AAAAMIgCAACAQRQAAAAMogAAAGBQwW4CrFatmspCG/kaNmyosr59+0a6tjTk6zQ+Hv1rz9KlS9PKo6hXr17G1wKZSHXy3tixY/M8SYkGDRrE8rmFgDsAAAAYRAEAAMAgCgAAAAZRAAAAMIgCAACAQQX7XQCh592HdvyHjnGcOnVqqcyUDwMGDFDZV199pbLQkcNAus4888y4R4Ax+/fvD+Z79uzJ8yQlmjVrFvm1W7ZsKcVJ8o87AAAAGEQBAADAIAoAAAAGUQAAADCoYDcBLliwINLrZs6cqbJ9+/blepyc69WrVzDv2LGjyubOnauy0DPbgXSFjtwGSlOZMuGvO8uXL6+yXG8MDH1Gp06dIl8/Y8aMXI4TO+4AAABgEAUAAACDKAAAABhEAQAAwCDnvU/9g86l/sFSVrFiRZV99NFHKgudknfqqaeWykxR1KhRQ2VDhgxRWf/+/YPXf/LJJyrr0KGDytavX5/BdPnlvXdxzxDnGk6CevXqqSy0wTTVxq1iVwhrWCS56/gXv/iFyiZMmBB87SuvvKKygQMHqmzx4sWRPvuMM85QWej34s6dOwevnzx5ssquvPJKle3duzfSPHFKtY5t/qoGAMA4CgAAAAZRAAAAMIgCAACAQQW7CTCkb9++KqtUqZLK1q1bp7K33347+J6hDU+H+2/yTa1bt1bZ+PHjVda0aVOVPffcc8H3vPrqq1W2YcOGSPMUmkLYQFVoa7jQRN0E2K5dO5W9/PLLpTJTISmENSxSXOu4e/fuwfyOO+5QWZ06dVT26quvqiz0e3abNm1UFlrbv/3tb4PzPPDAAypL9SjjQscmQAAAcBAFAAAAgygAAAAYRAEAAMCgRG0CDKlQoYLKQo8SPv3004PXv/766yoLbbqrUqWKys466yyVLVmyRGXXXXedykIbWYpNIWygSsIajlNoE+DatWtVNmnSJJWFTkUrNoWwhkVsrOPQ77GhU/q6du2qsh/84Acqe/rpp1U2btw4lSV1k3U62AQIAAAOogAAAGAQBQAAAIMoAAAAGJT4TYAhxxxzjMquuuqq4Gu7deumsiZNmqhs0aJFKps6darKQqdZWVUIG6iSuobzpWzZsiqbPn26ykKPpG7WrFnwPZcuXZr9YAWiENawCOsY2WETIAAAOIgCAACAQRQAAAAMogAAAGBQUW4CRGEohA1UrOH0Va9eXWVz5sxR2RFHHBG8PvQY1o0bN2Y/WAwKYQ2LsI6RHTYBAgCAgygAAAAYRAEAAMAgCgAAAAZRAAAAMIjvAkCpKYQd1Kzh0jNw4MBgXq1aNZXddNNNpT1OqSiENSzCOkZ2+C4AAABwEAUAAACDKAAAABhEAQAAwCA2AaLUFMIGKtYwslEIa1iEdYzssAkQAAAcRAEAAMAgCgAAAAZRAAAAMIgCAACAQRQAAAAMogAAAGAQBQAAAIMoAAAAGHTYkwABAEBx4g4AAAAGUQAAADCIAgAAgEEUAAAADKIAAABgEAUAAACDKAAAABhEAQAAwCAKAAAABlEAAAAwiAIAAIBBFAAAAAyiAAAAYBAFAAAAgygAaXLObTvkn33OuXvinguIyjlX0Tn3sHNulXNuq3NukXOufdxzAZlwzh3nnNvpnHss7lmSplzcAySN977qv/+3c66qiKwTkenxTQSkrZyIfCYirURktYh0EJFpzrmTvfefxjkYkIH7ROSduIdIIu4AZOcCEdkgIq/HPQgQlfd+u/f+Zu/9p977/d77OSKyUkROjXs2IB3OuR4iskVEXol7liSiAGTnEhF51Hvv4x4EyJRzrq6INBWRj+KeBYjKOXekiIwUkYFxz5JUFIAMOecaSckt1ClxzwJkyjlXXkQeF5Ep3vvFcc8DpGGUiDzsvV8T9yBJxR6AzPUSkTe89yvjHgTIhHOujIhMFZHdIvLLmMcBInPONReRc0WkRdyzJBkFIHO9RWRs3EMAmXDOORF5WETqikgH7/2emEcC0nG2iDQWkdUlS1mqikhZ59yJ3vuWMc6VKI6/vk6fc+6/RWSeiNTz3m+Nex4gXc6534lIcxE513u/Le55gHQ456qIyJHfiAZLSSHo773fGMtQCcQdgMxcIiIz+MMfSXRg/8rPRWSXiKw78BWUiMjPvfePxzYYEJH3/msR+frf/79zbpuI7OQP//RwBwAAAIP4LgAAAAyiAAAAYBAFAAAAgygAAAAYdNjvAnDOsUMQGfPeu29/VeliDSMbhbCGRVjHyE6qdcwdAAAADKIAAABgEAUAAACDKAAAABhEAQAAwCAKAAAABlEAAAAwiAIAAIBBFAAAAAyiAAAAYBAFAAAAgygAAAAYRAEAAMAgCgAAAAZRAAAAMIgCAACAQRQAAAAMogAAAGAQBQAAAIMoAAAAGFQu7gEARFOrVq1g3qNHD5WtWrVKZbNmzVJZmTL6a4Cbb75ZZa1atVLZvHnzgvN8+umnKnvyySeDrwUQH+4AAABgEAUAAACDKAAAABhEAQAAwCDnvU/9g86l/kHgW3jvXdwzFNMaTrWR7sILL1TZ3r17VVa+fHmVOad/ig73e0IU+/btU9lNN92ksltvvTWrz8mHQljDIsW1ji3461//qrJdu3ap7Mwzz8zHOCnXMXcAAAAwiAIAAIBBFAAAAAyiAAAAYJD5kwBbtmypsnbt2qns8ssvV9mxxx6rstAGqjVr1qjs4osvDs7z+uuvB3PYElqDofUmEt7IF9rwly9ly5ZV2WWXXaay0KbG1atXl8pMQGm54oorVNaiRQuVLVy4MB/jpIU7AAAAGEQBAADAIAoAAAAGUQAAADAo8ScBhjYctWnTRmWTJk0KXl+vXr1In1OxYsX0BvsW69evD+ahTYlr167N6WfnSyGcopaENVynTh2Vvfjiiypr3Lhx8PotW7ao7Oijj4702aVxEmBUixYtUlnXrl1VFufGwEJYwyLJWMdRhX6ORUQGDRqksi5duqhsw4YNOZ8pG6FHb9esWVNlvXr1UtnMmTNLZaZDcRIgAAA4iAIAAIBBFAAAAAyiAAAAYFCiTgKsW7euyh599FGVtW3bNuefvX//fpXt3LlTZaHNgqGNiqF/FxGRPn36qOyWW26JMCGSKrTR6eSTT1ZZqs1w11xzjcrGjBmjssmTJ6vstddeizKidOjQQWXDhg2LdG0qDRs2VNmRRx6Z1XuisHTs2FFlU6ZMCb62cuXKKqtQoULOZ8pG6LHWoY3kL7zwgsryteEvHdwBAADAIAoAAAAGUQAAADCIAgAAgEGJ2gR43XXXqSzbDX87duxQ2SuvvKKy8ePHq2zBggUqC23YGzJkSOR5QidIobiF1vDixYtVtnz58uD1oRP1fvzjH6ss9FjqqL73ve9lfG0qtWvXVlmnTp1U9uGHH+b8s5EfrVu3VlmVKlWCr1M4egAAAAelSURBVA39Xrxv376cz3SocuXCfwyed955Khs+fLjKtm3bprLRo0dnP1gecAcAAACDKAAAABhEAQAAwCAKAAAABiVqE2DosadRX/fUU08FXzt27FiVZfP40dCjIdPxt7/9LavrkTz9+/eP9LqNGzeW8iTxu+CCC1TGSZjJ0KBBA5WFNtJt3bo1eP2ll16qsnw8Cj30CHYRkWeeeUZloUdl/+QnP1FZUn4f5w4AAAAGUQAAADCIAgAAgEEUAAAADKIAAABgUKK+CyD0PPNKlSqp7IEHHlBZtrvzozrxxBOzuv6oo47K0SRICgu7+6P6+OOP4x4BGZoxY4bKjjvuOJUtXLgweP3MmTNzPtOhOnbsqLJ+/fpl9Z6ffPJJVtfHiTsAAAAYRAEAAMAgCgAAAAZRAAAAMChRmwA///xzlf3mN7+JYZLUTjvttKyuX7JkSY4mAXKnU6dOcY+AAtK0aVOVhTb8ZfueoaOEW7VqpbIWLVpE+ox69eqprFy58B+DoWN/ly5dqrJURxsnAXcAAAAwiAIAAIBBFAAAAAyiAAAAYFCiNgFasGbNmrhHAJTTTz89L58zb968vHwOomvcuLHKbr/9dpVVq1ZNZWXK6K8xK1asGPycf/zjH5Hmcc6pLLRhL6rQ+4mI7N69W2UTJkxQ2VdffZXxZ8eNOwAAABhEAQAAwCAKAAAABlEAAAAwiE2AWShfvrzKKlSokNV77tu3L6vrgWwNGjRIZUceeaTKUm2eQnGpX7++yjp06KCy0Ea8/fv3qyzVqX3ZbOTL5tpU5syZo7KHHnoo558TJ+4AAABgEAUAAACDKAAAABhEAQAAwCA2AWahSZMmKmvZsmWka5ctWxbMly9fntVMQLaGDRumsqpVq6osnY1X69evV9nvfvc7lT311FOR3xPF7/nnn1fZjh07VPbDH/5QZUcddVSkz/jzn/8czK+88spI1ycZdwAAADCIAgAAgEEUAAAADKIAAABgEJsAsxA6ISuq7du3B/Nt27Zl/J4ofDfccIPKom42evzxx4N56DGqe/bsUdmTTz6psgEDBqjsO9/5TqR5Ulm7dq3KHnzwQZWNGjUqq89BfoR+Pu+4445I14ZOiwxt7BMR+eSTTyJ9dpUqVVS2YMEClUXdBBja9CoismnTpkjXJxl3AAAAMIgCAACAQRQAAAAMogAAAGCQO9xpXs653D9jsYiMHj1aZaFNXiGLFi0K5lFPEkwC733sz4uNcw0fc8wxKnv99ddV1rBhw5x/dugxrKFNVrVq1VJZzZo1s/rse+65R2XXXHNNVu8Zl0JYwyL8XvxNDzzwgMouu+yySNeGNiB27tw565kKXap1zB0AAAAMogAAAGAQBQAAAIMoAAAAGEQBAADAII4CzkLTpk3jHgEFolu3biobM2aMykI7/r/88kuV3XrrrSpr165d8LNPPPFElYWOqT7++ONVFjqq9XDfGRTFE088kdX1wL81aNBAZaEd/6E1GzrK9/LLL8/NYEWCOwAAABhEAQAAwCAKAAAABlEAAAAwiE2AEYWOTD377LMzfr/Q86uRXHXq1FFZkyZNIl373HPPqWz8+PEqe/bZZ4PXT5gwQWWhTYC59sYbbwTzJUuWlPpnw4Ybb7wx42t//vOfq2zDhg3ZjFN0uAMAAIBBFAAAAAyiAAAAYBAFAAAAg9gEGFFow19oY2BUq1evzmIaFJNnnnlGZZUrV1bZfffdF7z+nHPOyflMUezcuTOY79mzJ8+ToBiETla96KKLIl27du1alb333ntZz1TsuAMAAIBBFAAAAAyiAAAAYBAFAAAAg9gEGFHHjh0zvnb37t0qmz17djbjoIhMmjRJZYsWLVJZOpv9tmzZorLt27erLPQ44CpVqqisWrVqKjv33HODnx16DPL111+vsl27dgWvR3Fr3LhxMJ8/f77KQusutGY/+ugjla1atSr94YzhDgAAAAZRAAAAMIgCAACAQRQAAAAMYhNgHrz00ksqW7FiRQyToLS89tprKps8ebLK+vTpo7LQo3tD2Y4dO4KfvWnTJpV16tRJZX//+9+D1x/q5JNPVtmcOXNUluqRwwMGDFBZaMNfaGMgil+qdVO3bl2Vee9V9uijj6ps2LBh2Q9mEHcAAAAwiAIAAIBBFAAAAAyiAAAAYBCbAIEcCG2w69evn8reeecdldWoUSPSZ8ycOTOYL126NNL1UYX+XRo1aqSyK664Inh9jx49VHb//fdnPxggIh988IHK1qxZE8MkyccdAAAADKIAAABgEAUAAACDKAAAABjEJkAgjx588MG4R8iZVP8uxfTviHi9++67KnvooYdimKQ4cQcAAACDKAAAABhEAQAAwCAKAAAABlEAAAAwiO8CiOi2225TWfv27VVWu3ZtlS1fvrxUZgKApFm4cGEwL1eOP47yjTsAAAAYRAEAAMAgCgAAAAZRAAAAMMh571P/oHOpfxD4Ft57F/cMrGFkoxDWsAjrGNlJtY65AwAAgEEUAAAADKIAAABgEAUAAACDKAAAABhEAQAAwCAKAAAABlEAAAAwiAIAAIBBhz0JEAAAFCfuAAAAYBAFAAAAgygAAAAYRAEAAMAgCgAAAAZRAAAAMOj/AMxGw6nEpMC2AAAAAElFTkSuQmCC
" />
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dls</span><span class="o">.</span><span class="n">train_ds</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">img</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(28, 28)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Using-fullblown-fastai">Using fullblown fastai<a class="anchor-link" href="#Using-fullblown-fastai"> </a></h3><p>Fastai has made it possible to create a deep learning model using just two lines of code and give an oner 95% accuracy within a few minutes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>While this is really elegant and easy to use, I am still new to many of these concepts and the whole point of this blog post is for me to build a learner from scratch and use as few of these consolidated functions as possible. So I will explore this below and hopefully be able to achieve a comparable performance.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">cnn_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">resnet18</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">loss_func</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Sequential (Input shape: 64)
============================================================================
Layer (type)         Output Shape         Param #    Trainable 
============================================================================
                     64 x 64 x 14 x 14   
Conv2d                                    9408       True      
BatchNorm2d                               128        True      
ReLU                                                           
MaxPool2d                                                      
Conv2d                                    36864      True      
BatchNorm2d                               128        True      
ReLU                                                           
Conv2d                                    36864      True      
BatchNorm2d                               128        True      
Conv2d                                    36864      True      
BatchNorm2d                               128        True      
ReLU                                                           
Conv2d                                    36864      True      
BatchNorm2d                               128        True      
____________________________________________________________________________
                     64 x 128 x 4 x 4    
Conv2d                                    73728      True      
BatchNorm2d                               256        True      
ReLU                                                           
Conv2d                                    147456     True      
BatchNorm2d                               256        True      
Conv2d                                    8192       True      
BatchNorm2d                               256        True      
Conv2d                                    147456     True      
BatchNorm2d                               256        True      
ReLU                                                           
Conv2d                                    147456     True      
BatchNorm2d                               256        True      
____________________________________________________________________________
                     64 x 256 x 2 x 2    
Conv2d                                    294912     True      
BatchNorm2d                               512        True      
ReLU                                                           
Conv2d                                    589824     True      
BatchNorm2d                               512        True      
Conv2d                                    32768      True      
BatchNorm2d                               512        True      
Conv2d                                    589824     True      
BatchNorm2d                               512        True      
ReLU                                                           
Conv2d                                    589824     True      
BatchNorm2d                               512        True      
____________________________________________________________________________
                     64 x 512 x 1 x 1    
Conv2d                                    1179648    True      
BatchNorm2d                               1024       True      
ReLU                                                           
Conv2d                                    2359296    True      
BatchNorm2d                               1024       True      
Conv2d                                    131072     True      
BatchNorm2d                               1024       True      
Conv2d                                    2359296    True      
BatchNorm2d                               1024       True      
ReLU                                                           
Conv2d                                    2359296    True      
BatchNorm2d                               1024       True      
AdaptiveAvgPool2d                                              
AdaptiveMaxPool2d                                              
Flatten                                                        
BatchNorm1d                               2048       True      
Dropout                                                        
____________________________________________________________________________
                     64 x 512            
Linear                                    524288     True      
ReLU                                                           
BatchNorm1d                               1024       True      
Dropout                                                        
____________________________________________________________________________
                     64 x 10             
Linear                                    5120       True      
____________________________________________________________________________

Total params: 11,708,992
Total trainable params: 11,708,992
Total non-trainable params: 0

Optimizer used: &lt;function Adam at 0x7f7e67048b90&gt;
Loss function: &lt;function cross_entropy at 0x7f7e8c55bd40&gt;

Callbacks:
  - TrainEvalCallback
  - Recorder
  - ProgressCallback</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Starting-the-modelling">Starting the modelling<a class="anchor-link" href="#Starting-the-modelling"> </a></h3><p>So the first step now would be to decide the structure of the Neural Network,  initialize the weights and define the loss function. I am deciding to use  to create a three layer neural network and then see what happens if we use another layer and see if it matters if the layer is a linear unit or a ReLU.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using a Sigmoid function that converts any output to a value between 0 and 1 to create our loss function.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">resnet50</span><span class="p">,</span> 
                <span class="n">loss_func</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-58-b3d4bfc023f2&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> learn = Learner(dls, resnet50, 
<span class="ansi-green-intense-fg ansi-bold">      2</span>                 loss_func=F.cross_entropy, metrics=accuracy)
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>learn<span class="ansi-blue-fg">.</span>fit_one_cycle<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0.1</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastai/callback/schedule.py</span> in <span class="ansi-cyan-fg">fit_one_cycle</span><span class="ansi-blue-fg">(self, n_epoch, lr_max, div, div_final, pct_start, wd, moms, cbs, reset_opt)</span>
<span class="ansi-green-intense-fg ansi-bold">    105</span>                   moms=None, cbs=None, reset_opt=False):
<span class="ansi-green-intense-fg ansi-bold">    106</span>     <span class="ansi-blue-fg">&#34;Fit `self.model` for `n_epoch` using the 1cycle policy.&#34;</span>
<span class="ansi-green-fg">--&gt; 107</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>opt <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">.</span>create_opt<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    108</span>     self<span class="ansi-blue-fg">.</span>opt<span class="ansi-blue-fg">.</span>set_hyper<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;lr&#39;</span><span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>lr <span class="ansi-green-fg">if</span> lr_max <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">else</span> lr_max<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    109</span>     lr_max <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>array<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>h<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;lr&#39;</span><span class="ansi-blue-fg">]</span> <span class="ansi-green-fg">for</span> h <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>opt<span class="ansi-blue-fg">.</span>hypers<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastai/learner.py</span> in <span class="ansi-cyan-fg">create_opt</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    147</span>     <span class="ansi-green-fg">def</span> _bn_bias_state<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> with_bias<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> norm_bias_params<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">,</span> with_bias<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>map<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>opt<span class="ansi-blue-fg">.</span>state<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    148</span>     <span class="ansi-green-fg">def</span> create_opt<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 149</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>opt <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>opt_func<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>splitter<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> lr<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>lr<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    150</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> self<span class="ansi-blue-fg">.</span>wd_bn_bias<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    151</span>             <span class="ansi-green-fg">for</span> p <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>_bn_bias_state<span class="ansi-blue-fg">(</span><span class="ansi-green-fg">True</span> <span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> p<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;do_wd&#39;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">False</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastai/torch_core.py</span> in <span class="ansi-cyan-fg">trainable_params</span><span class="ansi-blue-fg">(m)</span>
<span class="ansi-green-intense-fg ansi-bold">    599</span> <span class="ansi-green-fg">def</span> trainable_params<span class="ansi-blue-fg">(</span>m<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    600</span>     <span class="ansi-blue-fg">&#34;Return all trainable parameters of `m`&#34;</span>
<span class="ansi-green-fg">--&gt; 601</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">[</span>p <span class="ansi-green-fg">for</span> p <span class="ansi-green-fg">in</span> m<span class="ansi-blue-fg">.</span>parameters<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> p<span class="ansi-blue-fg">.</span>requires_grad<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    602</span> 
<span class="ansi-green-intense-fg ansi-bold">    603</span> <span class="ansi-red-fg"># Cell</span>

<span class="ansi-red-fg">AttributeError</span>: &#39;function&#39; object has no attribute &#39;parameters&#39;</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">threeLayerNet</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
                              <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
                              <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">fourLayerNet1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
                              <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
                              <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">fourLayerNet2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
                              <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
                              <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">threeLayerNet</span><span class="p">,</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">SGD</span><span class="p">,</span>
                <span class="n">loss_func</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">train_ds</span><span class="o">.</span><span class="n">items</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Path(&#39;training/8/25379.png&#39;),
 Path(&#39;training/5/31053.png&#39;),
 Path(&#39;training/5/24180.png&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">valid_ds</span><span class="o">.</span><span class="n">items</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Path(&#39;training/2/13925.png&#39;),
 Path(&#39;training/2/1660.png&#39;),
 Path(&#39;training/2/45158.png&#39;),
 Path(&#39;training/9/25083.png&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">xb</span><span class="p">,</span> <span class="n">yb</span> <span class="o">=</span> <span class="n">first</span><span class="p">(</span><span class="n">dls</span><span class="p">)</span>
<span class="n">xb</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">yb</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-60-217c8f522796&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>xb<span class="ansi-blue-fg">,</span> yb <span class="ansi-blue-fg">=</span> first<span class="ansi-blue-fg">(</span>dls<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> xb<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">,</span> yb<span class="ansi-blue-fg">.</span>shape

<span class="ansi-red-fg">ValueError</span>: too many values to unpack (expected 2)</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">doc</span><span class="p">(</span><span class="n">cnn_</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">train_x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">train_y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(torch.Size([60000, 784]), torch.Size([60000, 1]))</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(torch.Size([784]), tensor([0]))</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">eight_tensors</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  31, 162, 212, 208,  95,   4,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  58, 239, 254, 227, 220, 255, 157, 103, 175,  71,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  25, 216, 246, 107,   7,   2, 121, 254, 254, 254, 217,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0, 148, 254,  92,   0,   0,   4, 149, 254, 254, 150,   8,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  52, 254, 169,   1,   0,  36, 193, 254, 254, 135,   1,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0, 130, 254,  60,   0,  70, 239, 254, 230,  83,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0, 125, 254,  84, 125, 249, 254, 200,  59,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  41, 245, 245, 254, 247, 130,   9,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  22, 147, 254, 255, 206,  44,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  83, 216, 254, 254, 254,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,  25, 187, 251, 254, 216, 163, 245,  16,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,  24, 130, 247, 254, 219, 105,   7, 179, 235,  11,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,  51, 209, 254, 233, 136,  15,   0,  53, 237, 186,   5,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,  35, 245, 254, 246,  48,   0,   0,  31, 222, 252,  69,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0, 185, 254, 254, 254, 248, 218, 218, 237, 246,  96,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0, 115, 150, 150, 150, 150, 150, 150, 150,  93,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0]], dtype=torch.uint8)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Doing the same for the testing data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Building-the-Baseline-Model:-KNN">Building the Baseline Model: KNN<a class="anchor-link" href="#Building-the-Baseline-Model:-KNN"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>One of the things emphasized in the fastai course is the need to first create a baseline model. Having an accuracy of over 90% means nothing if a simple arithmetic model has an accuracy of 95%. I have also created many fancy machine learning models only to find that using a simpler model performed far better. A model is useless if it fails to beat a simple benchmark. While it's tempting to rush in and start writing in some fancy code, it might be a good idea to create a simple baseline model to assess the quality of the model's accuracy. Here is the description of a Baseline model from the fastai course:</p>
<blockquote><p>jargon:Baseline: A simple model which you are confident should perform reasonably well. It should be very simple to implement, and very easy to test, so that you can then test each of your improved ideas, and make sure they are always better than your baseline. Without starting with a sensible baseline, it is very difficult to know whether your super-fancy models are actually any good. One good approach to creating a baseline is doing what we have done here: think of a simple, easy-to-implement model. Another good approach is to search around to find other people that have solved similar problems to yours, and download and run their code on your dataset. Ideally, try both of these!
As the MNSIT I am trying to do is a bit more complex than the sample MNSIT example in lesson 4 of the course. I am going to try and build a simple KNN Classifier and see how well this performs and hopefully should be able to get a better result using Deep Learning. This will also give me an opportunity of using Tensors to build a KNN</p>
</blockquote>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">euc_dist</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This script will need a way to create X and Y datasets</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Doing the same for the testing data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Running the model to check the results. Got a first hand understanding of how slow the computation is because of the loops</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">KNN</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">=</span><span class="mi">3</span>
  
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">x_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span>
  
    <span class="k">def</span> <span class="nf">old_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">):</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)):</span>
            <span class="c1">#dist = torch.tensor([euc_dist(X_test[i], x_t) for x_t in self.X_train])</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_t</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">])</span>
            <span class="n">dist_sorted</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist</span><span class="p">)[:</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">]</span>
            <span class="n">neigh_count</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">dist_sorted</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">in</span> <span class="n">neigh_count</span><span class="p">:</span>
                    <span class="n">neigh_count</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">neigh_count</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">sorted_neigh_count</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">neigh_count</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sorted_neigh_count</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> 
        <span class="k">return</span> <span class="n">predictions</span>       

        <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">):</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)):</span>
            <span class="c1">#dist = torch.tensor([euc_dist(X_test[i], x_t) for x_t in self.X_train])</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_t</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">])</span>
            <span class="n">dist_sorted</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist</span><span class="p">)[:</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">]</span>
            <span class="n">neigh_count</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">dist_sorted</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">in</span> <span class="n">neigh_count</span><span class="p">:</span>
                    <span class="n">neigh_count</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">neigh_count</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">sorted_neigh_count</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">neigh_count</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sorted_neigh_count</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> 
        <span class="k">return</span> <span class="n">predictions</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">KNN</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="n">accuracy_score</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">test_y</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">three_tensors</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">three_tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">three_tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">three_tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="nitinkash/fastai-deeplearning"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/fastpages/jupyter/mnist/image%20classification/sgd/2021/05/02/_04_18_MNIST_Nitin.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Yet another Data Science Blog</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/nitinkash" title="nitinkash"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/1nitinkashyap" title="1nitinkashyap"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/nikashyap" title="nikashyap"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
